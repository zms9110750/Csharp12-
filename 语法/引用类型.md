# 引用类型

**引用**是指，我不直接包含这些东西，只是告诉你怎么找到这些东西。

例如，当你看到一个视频觉得很有趣，想分享给你的朋友时，
你一般会直接发送链接而不是先下载整个视频。因为下载视频太慢了。

你声明数组时可以轻易要求它创建上亿个变量。
如果这些数据在程序中传递时如果都完全复制，那么程序也会觉得很慢。
所以它发出去的，也是链接。

下载和传递链接的区别是很大的。使用链接访问的东西，并不是独属于你的东西。
例如视频，权限还在作者手里，他可以下架这个视频，这样你和你朋友都看不到了。

## 窜号

而引用类型，相当于在使用`new`创建值的时候注册了账号密码。
在赋值给变量的时候，相当于共享账号密码。
一个人登录账号做出修改后，别人再登录账号也能看到改动。

```csharp
int []arr1 = [1, 2, 3, 4];
var arr2 = arr1;
Console.WriteLine(arr1[0]);//1
Console.WriteLine(arr2[0]);//1
arr1[0] = 33;
Console.WriteLine(arr1[0]);//33
Console.WriteLine(arr2[0]);//33
```

引用类型的修改，指的是对内容的修改，说的是通过`.`或`[]`访问的东西。
如果直接对变量重新赋值，那相当于换了一个新的账号密码。

## 比较，只读

由于变量本身存储的只有引用/地址/链接/账号。里面的内容不受这个变量管理。

所以当对引用类型进行比较时，只会判断对他是否引用的是同一内容。
无论他们引用的内容里具体的值是否相同。

而对变量添加只读时，也仅仅是让他无法更换引用到其他值，而不能控制这个值的内容无法改变。

```csharp
int[] arr3 = [1];
int[] arr4 = [1];
Console.WriteLine(arr3.Length == arr4.Length);//true
Console.WriteLine(arr3[0] == arr4[0]);//true
Console.WriteLine(arr3 == arr4);//false
```

## 如何分辨引用类型

分辨引用类型最简单的办法就是看这个类型能不能接受`null`值。
如果有IDE的话，可以在设置里对文本着色，给引用类型和值类型上不同颜色。

# null

`null`表示不引用值。
数组可以创建长度为0的数组，字符串可以创建空字符串。
尽管这两者情况下，他们看起来无法使用，但和使用`null`还是有区别的。

以刷单类比，你在下单后卖家给你寄一个空盒子快递。
跟你不下单相比，虽然你收到的东西都没有用，
但这个过程产生了订单号，快递单号，产生了这些附随的数据。

在创建0长度数组和空字符串的过程中，
尽管你不能访问他们的元素，但还有其他的内容可以访问。
而`null`没有任何数据，你不能访问他们的任何内容。

```csharp
string s1 = "";
string s2 = null;
Console.WriteLine(s1.Length);//得到0
Console.WriteLine(s2.Length);//报错
```

## 空警报

访问`null`值的内容，是开发时最常见的报错。
一次更新后添加了分析器对`null`值的分析，并会产生警告。
警告不会阻止程序的编译。

当你对引用类型赋值一个`null`值时，
和尝试访问分析器判断可能为`null`值的内容时，
会得到一个警告。

如果想避免这个警告，
可以在变量类型后加上`?`表示这个变量允许接收`null`值，
或在赋值/访问的值后面加`!`表示容忍此处可能为`null`值。

```csharp
string s1 = null;
string? s2 = null!;

Console.WriteLine(s1.Length);
Console.WriteLine(s2!.Length);
```

# 可空值类型

引用类型后加上`?`仅仅是给分析器提示，本身不会添加什么东西。
而给值类型后加上`?`会实际地改变类型。

```csharp
int? i2 = null; 
Console.WriteLine(i2.HasValue);
```

## 提升运算符

可空值类型继承了基础类型的运算符，这一特性是配合编译器联合工作的结果，我们无法复刻。
可空值类型在使用基础类型的运算符时，遵循以下规则：

- 如果没有`null`参与，按基础类型的方式执行。但返回值为可空值类型。
- 当使用关系运算符时
  - 当双方为`null`且使用`==`运算时，返回`true`
  - 当仅一方为`null`且使用`!=`运算时，返回`true`
  - 否则返回`false`
- 其他二元运算符返回`null`

# 空传播

在访问内容的`.`或`[]`前加上`?`，可以在左侧为`null`时终止右侧的内容访问。
得到该类型的`null`值（值类型就得到这个类型的可空值类型）。

```csharp
string? s = null;
Console.WriteLine(s?.Length);

(string, int)? t = null;
Console.WriteLine(t?.Item1);
```

## 空合并运算

在一个值后面加上`??`表示如果左侧值为`null`，则用右侧值为默认值。

```csharp
string? s = null;
int len = s?.Length ?? 0;
s ??= "hello";
```
