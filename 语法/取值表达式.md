# 取值表达式

## 三元运算

三元运算类似于一个`if-else`语句，但这个表达式只能用于获取值。
`string s = i % 2 == 0 ? "偶数" : "奇数";`。
三元表达式的`?`左侧是一个条件，右侧是`:`隔开的两个值。

右侧的两个值必须能转为同一类型，这样整个表达式才能得到合理的类型。

三元表达式可以嵌套，但一般在右侧候选值嵌套，以便于理解。

```csharp
int i2 = 10;
string s2 = i2 < 2 ? "S"
 : i2 < 4 ? "A"
 : i2 < 10 ? "B"
 : "C";
```

## switch表达式

`switch`表达式类似于一个`switch`选择语句。但这个表达式也只能用来获取值。
`switch`表达式没有`()`包围需要判断的值，它判断的值是这个关键字左侧最接近的那个值。

```csharp
int i = 0;
string s = (i % 2) switch
{
 0 => "偶数",
 1 => "奇数",
 _ => "错误结果"
};
```

大于等于符号的`=`在右边。`switch`的分支臂的`=`在左边。

`switch`表达式分支左侧是判断匹配的值，右侧是此情况下返回的值。
右侧的所有值需要能转化为同一类型。

和`switch`选择不同的是，`switch`表达式使用`_`表示都不匹配的情况，但`switch`表达式的判断是有序的。
这个分支必须放在最后一个。

`switch`选择的判断匹配的值可以不包含所有情况，但如果运行时恰好遇到了无法匹配的情况，会报错。

另外，`switch`表达式也可以使用`when`进行一个次要判断。
在有次要判断切不为常量的情况下，`_`也不保证一定能匹配，可以不放在最后。

```csharp
int a = 1, b = 2;
var s2 = a switch
{
 _ when a < b => true,
 1 => true,
 2 when a > b => true,
 _ => false
};
```

## 内联抛出异常

在三元运算和`switch`表达式中，候选项可以用抛出异常代替。
抛出异常会中断运行，之后的类型判断没有意义，因此不会分析他们的类型。

但所有候选项中，至少有一个是普通的值，否则整个表达式不能计算值，本身没有意义。

```csharp
int i = 0;
string s = (i % 2) switch
{
 0 => "偶数",
 1 => "奇数",
 _ => throw new Exception("错误结果")
};
var s2 = i % 2 == 0 ? "偶数" : throw new Exception("此处不应该是奇数");
```

## 插值字符串

在字符串前加上`$`修饰，可以将字符串改为插值字符串格式。
插值字符串可以接收一对大括号的占位符，里面使用计算的值。

此时的大括号需要连写两个来转义。

在使用原始字符串时，可以加上多个`$`修饰，在字符串中，需要使用同等数量的连续`{`和`}`来启用和结束占位。

```csharp
string name1 = "小明";
int age1 = 12;
Console.WriteLine($"名字是:{name1}，年龄是{age1}，转义后的大括号{{}}");
Console.WriteLine($$$"""名字是:{{{name1}}}，年龄是{{{age1}}}""");
```

### 空格占位

在插值后，可以接一个逗号和一个常量，表示这个值至少要占多少个字符。
如果没有达到指定数量，就会用空格补齐。达到或超过则无事发生。
如果是正数，空格会补在前面，如果是负数，空格会补在后面。

```csharp
Console.WriteLine($"123456789012345678901234567890");
Console.WriteLine($"12|{456,6}0|23456789|{123,-7}|90");
```

### 格式说明符

在插值后（或空格占位后）可以加上冒号来描述这个类型的格式说明。
格式说明是由类型单独定义的。

```csharp
double e = 12.123456;
int f = 285;
Console.WriteLine($"{f:d5}");//00285，以前导0补足指定数量的数字
Console.WriteLine($"{f:x}");//11d，以16进制显示。字母部分的大小写取决于说明符的大小写
Console.WriteLine($"{d:f3}");//12.123，指定小数位数,会四舍五入或补0来达到指定位数
Console.WriteLine($"{d:e2}");//1.21e+001，科学计数法显示，e后面的数字即小数点后的有效数字，四舍五入
```

内置的说明符请参阅[这里](https://learn.microsoft.com/zh-cn/dotnet/standard/base-types/standard-numeric-format-strings)。