# 模式匹配

模式匹配是一系列与常量进行比较的表达式。  
可以与`switch`选择和表达式配合使用。  
单独使用（如在`if`中）则需要使用`is`开启。

## 值判断

- 关系判断可以判断一个值是否为某一常量
    - 若要与数字类型比较，则可以使用`>`，`<`，`>=`，`<=`
    - 若被判断的类型编译器已知是几种可为常量的数字类型，则可以跨类型比较值
- 如果有且或非，需要用关键字`and`,`or`,`not`

### 关系

关系判断可以判断一个值是否为某一常量。  
如果是数字类型，则可以加上`>`，`<`，`>=`，`<=`进行范围判断。
如果数字类型在被判断时已知类型是值类型，那么

和数字比较时可以加上`>`，`<`，`>=`，`<=`，如果判断相等则不需要加符号。
如果判断不相等，则需要使用逻辑的非

```csharp
float f = 1f;
Console.WriteLine(f is 1);//true
						  //已知是基础数字类型的可以跨类型比较
Console.WriteLine(f is >= 1f and <= 2f);//true

object o = f;
Console.WriteLine(o is >= 1 or <= 1);//false
									 //已经被装箱的数字需要匹配类型
Console.WriteLine(o is not (2f or <= 0f));//true
										  //优先级and>or>not。可以用括号改变优先级

```

## 内容判断

- 用`{}`展开一个值的属性，可以嵌套地对里面的属性进行模式匹配
    - 一个什么属性也不检查的空`{}`相当于`xx is not null`
- 如果一个值可以被迭代，则可以用`[]`嵌套地对他的元素进行模式匹配
    - 列表模式可以用`..`表示任意个元素，使得表达式只检查头尾指定数量的元素
        - `..`在一个列表模式里之多用一个，否则无法区分元素所在位置

```csharp
string s = "hello";
if (s is { Length: 5 })
{
	Console.WriteLine("长度为5");
}
if (s is ['h', 'e', ..])
{
	Console.WriteLine("以he开头");
}
```

## 类型判断

- 直接填写类型可以判断值是否为此类型
    - 若只判断为一个类型，可以同时声明变量
    - 类型后可接内容判断或值判断
    - 可以以`var`匹配任何类型来声明中间变量，以写单一表达式

```csharp
object o = "hello";
switch (o)
{
	case string { Length: var len } s2:
		Console.WriteLine(s2 + len);
		break;
	case int or float:
		break;
}

if (o is not int i)
{
	i = 2;
}
Console.WriteLine(i);
```

## 解构

- 如果一个值可以被解构，则可以边解构边进行匹配
    - 用`_`表示舍弃
    - 可以同时进行类型判断来进行解构

```csharp
switch ((12, "小米"))
{
	case ( > 5, { Length: >= 5 }):
	case { Item1: > 3 }://元组仍然可以用内容判断
	case (var age, _):
	default:
		break;
}
object o2 = (age: 12, name: "小米");
switch (o2)
{
	case ValueTuple<int, int>(var a, var b)://元组类型的书面写法
	case ValueTuple<int, string>(> 5, { Length: var len2 }):
	default:
		break;
}
```