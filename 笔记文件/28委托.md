# 委托
委托是方法的类型，有了类型就能声明变量。
有了变量就可以声明参数，或者储存在数组等容器里以动态调用。

## Action
`Action`委托是返回`void`的委托。
他的各泛型版本对应了方法的参数类型。

无参无返回值的方法就使用他的无泛型版本。
## Func
`Func`委托是有返回值的委托。它只有泛型的版本。
它的最后一个泛型代表方法的返回值类型。前面的泛型是方法的参数类型。
 
## 自定义委托
预置的`Action`和`Func`委托类型以及他们的各泛型版本，在大多数情况下都能满足我们使用。
但一些情况下我们仍然必须创建自己的委托类型，例如参数中具有`ref`,`out`,`in`的时候。

==委托是类型==，是和类，结构，接口同级别的东西，所以委托可以直接定义在命名空间下。
委托类型使用`delegate`关键字声明，后面跟随一个方法签名，没有方法主体。

## 多播委托
在给委托类型的变量赋值时，方法不能带有括号。
带括号和参数的是调用方法，获取的值是方法执行完的返回值。
用来给委托进行赋值的，称为==方法组==。

一个委托中可以记录多个方法组。
以`委托+方法组`的形式将方法链接至委托末尾。
有多个方法组的委托称为多播委托。

如果使用减法运算，则可以从记录的委托中删除一个委托。
如果目标方法组没有被记录，则无事发生。

## 执行委托

委托变量可以像方法一样直接在后面加括号和参数调用。
就像委托变量本身就是一个方法名一样。

如果是多播委托，则返回值仅获取最后一个方法的返回值。

# 事件
事件是仅用于委托的访问器。他有`add`和`remove`两个访问器。
声明方式为在委托类型前加`event`关键字。但无逻辑的事件不需要写`{add;remove;}`

事件只能出现在`+=`和`-=`的左边，分别会调用他的`add`和`remove`访问器。
但如果在声明类不是接口，且事件不是抽象的，没有访问器逻辑，
那么会自动生成一个匿名委托，在声明类内，可以像直接访问委托一样访问事件。

只对外部暴露事件可以防止外部修改别人注册的事件。
如果要取消注册，必须访问到注册时的方法组，意味着必须有他的访问权限。

# 匿名方法

匿名方法是用来给委托快速赋值时，简便语法生成方法组的语法。
编译器实际上会把匿名委托编译成完整的成员方法。

一个匿名方法的定义如下：
`void (int i)=>{ Console.WriteLine(i * i);}`

如果能根据赋值的变量类型推断出参数类型和返回值类型，可以省略他们。
如果参数只有一个，则可以省略参数的括号。
如果方法主体只有一条语句，则可以省略方法体的大括号。

因此，在赋值时，上面的匿名方法可以写为
`Action<int> _ = i => Console.WriteLine(i * i);`

# 捕获变量
在匿名方法和局部方法内，有时会使用到这个方法中的局部变量。
这时候称为捕获变量，他们会延长作用域，直到不被使用。

在方法内使用的捕获变量是对原变量的引用。
修改和访问都是他们实时的值。

例如在循环中使用迭代变量创建委托，
执行时，访问到的是循环结束时迭代变量的值，而不是创建委托时的值。


